.modal-overlay {
  position: fixed; inset: 0;
  background: rgba(6,6,10,0.85);
  backdrop-filter: blur(16px);
  z-index: 100;
  display: flex; align-items: center; justify-content: center;
  padding: 20px;
  animation: fadeIn 0.2s;
}

.modal-card {
  background: #0a0a0f;
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 24px;
  max-width: 460px; width: 100%;
  max-height: 90vh; overflow-y: auto;
  animation: cardReveal 0.3s cubic-bezier(0.16,1,0.3,1);
}

.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; }
.modal-title-text { font-family: var(--font-display); font-size: 20px; font-weight: 700; }
.modal-close { background: #111118; border: 1px solid var(--border); color: #6a6670; width: 30px; height: 30px; border-radius: 8px; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
.modal-close:hover { background: #1a1a20; color: var(--text-primary); }

.m-input {
  width: 100%; background: var(--bg-input); border: 1px solid var(--border);
  border-radius: 8px; padding: 10px 12px; color: var(--text-primary);
  font-size: 13px; margin-bottom: 10px; transition: border-color 0.2s;
}
.m-input:focus { border-color: rgba(196,85,58,0.25); }
.m-input-title { font-family: var(--font-display); font-size: 17px; font-weight: 600; }
.m-textarea { resize: vertical; font-family: var(--font-display); font-style: italic; }

.m-search-wrap { position: relative; }

.m-search-spinner {
  position: absolute; right: 12px; top: 11px;
  font-size: 14px; color: var(--text-muted);
  animation: spin 0.8s linear infinite;
}
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

.m-search-results {
  position: absolute; top: 100%; left: 0; right: 0;
  background: #0f0f16;
  border: 1px solid var(--border);
  border-top: none;
  border-radius: 0 0 10px 10px;
  max-height: 280px; overflow-y: auto;
  z-index: 10;
  box-shadow: 0 12px 40px rgba(0,0,0,0.6);
}

.m-search-item {
  display: flex; align-items: center; gap: 10px;
  padding: 8px 12px;
  cursor: pointer;
  transition: background 0.15s;
  border-bottom: 1px solid rgba(255,255,255,0.03);
}
.m-search-item:last-child { border-bottom: none; }
.m-search-item:hover, .m-search-item.selected { background: rgba(196,85,58,0.08); }

.m-search-cover {
  width: 32px; height: 46px;
  object-fit: cover;
  border-radius: 3px;
  flex-shrink: 0;
}
.m-search-cover-placeholder {
  width: 32px; height: 46px;
  display: flex; align-items: center; justify-content: center;
  background: rgba(255,255,255,0.03);
  border-radius: 3px;
  font-size: 16px;
  flex-shrink: 0;
}

.m-search-info { flex: 1; min-width: 0; }
.m-search-book-title {
  font-family: var(--font-display); font-size: 13px; font-weight: 600;
  color: var(--text-primary);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.m-search-book-author {
  font-size: 11px; color: var(--text-muted);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}

/* ── Selected Book Preview ── */
.m-selected-preview {
  display: flex; align-items: center; gap: 10px;
  padding: 8px 10px;
  background: rgba(196,85,58,0.06);
  border: 1px solid rgba(196,85,58,0.15);
  border-radius: 8px;
  margin-bottom: 10px;
}
.m-preview-cover {
  width: 36px; height: 52px;
  object-fit: cover;
  border-radius: 3px;
  flex-shrink: 0;
}
.m-preview-info { flex: 1; min-width: 0; }
.m-preview-title {
  font-family: var(--font-display); font-size: 13px; font-weight: 600;
  color: var(--text-primary);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.m-preview-author { font-size: 11px; color: var(--text-muted); }
.m-preview-clear {
  background: none; border: none; color: var(--text-muted);
  font-size: 18px; cursor: pointer; padding: 4px;
  transition: color 0.2s;
}
.m-preview-clear:hover { color: var(--text-primary); }

.m-label { font-family: var(--font-mono); font-size: 10px; color: var(--text-secondary); letter-spacing: 1.5px; text-transform: uppercase; margin-bottom: 8px; margin-top: 6px; }

.m-emo-grid { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 14px; }
.m-emo-tag { display: inline-flex; align-items: center; gap: 5px; padding: 5px 11px; border-radius: 18px; border: 1px solid var(--border); color: var(--text-muted); font-size: 12px; cursor: pointer; transition: all 0.2s; user-select: none; }
.m-emo-tag:hover { border-color: var(--tc); }
.m-emo-tag.active { background: color-mix(in srgb, var(--tc) 15%, transparent); border-color: color-mix(in srgb, var(--tc) 50%, transparent); color: var(--tc); }

.m-slider-row { display: flex; align-items: center; gap: 10px; margin-bottom: 14px; }
.m-slider-val { font-family: var(--font-mono); font-size: 12px; color: var(--text-muted); width: 18px; }
.m-slider { flex: 1; appearance: none; height: 4px; background: var(--border); border-radius: 2px; outline: none; }
.m-slider::-webkit-slider-thumb { appearance: none; width: 14px; height: 14px; border-radius: 50%; background: var(--rust); cursor: pointer; }
.m-slider-label { font-size: 10px; color: var(--text-muted); width: 50px; text-align: right; }

.m-echo-section { background: rgba(107,58,93,0.04); border: 1px solid rgba(107,58,93,0.13); border-radius: 10px; padding: 12px; margin-top: 6px; margin-bottom: 14px; }
.m-echo-label { font-family: var(--font-mono); font-size: 10px; color: var(--plum); letter-spacing: 1.5px; text-transform: uppercase; margin-bottom: 8px; }
.m-echo-input { background: transparent !important; border-color: rgba(107,58,93,0.13) !important; font-family: var(--font-display); font-style: italic; }
.m-echo-hint { font-size: 10px; color: var(--text-muted); margin-top: 4px; }

.modal-actions { display: flex; justify-content: flex-end; gap: 8px; margin-top: 8px; align-items: center; flex-wrap: wrap; }
.m-error {
  font-size: 11px; color: #e55; flex: 1 1 100%;
  text-align: center; margin-bottom: 4px;
}
.m-btn { border: none; border-radius: 8px; padding: 10px 20px; font-size: 13px; font-weight: 500; cursor: pointer; transition: opacity 0.2s; }
.m-btn:disabled { opacity: 0.5; }
.m-btn-primary { background: linear-gradient(135deg, var(--rust), var(--rust-light)); color: #fff; }
.m-btn-danger { background: transparent; border: 1px solid rgba(196,85,58,0.2); color: var(--rust); }
.m-search-custom { border-top: 1px solid rgba(255,255,255,0.08); opacity: 0.7; }
.m-search-custom:hover { opacity: 1; }